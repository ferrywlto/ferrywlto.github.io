---
import { getCollection } from "astro:content";
import BaseLayout from "./BaseLayout.astro";
import TagPill from "../components/TagPill.astro";
import type { TaggableCollection } from "../types";

export interface Props {
  title: string;
  description: string;
  collection: TaggableCollection;
  header: string;
}
const { title, description, collection, header } = Astro.props;

const entries = await getCollection(collection);

const allTags = [
  ...new Set(entries.map((post) => post.data.tags).flat()),
];

// Calculate tag frequencies and create tag data with counts
const tagsWithCounts = allTags
  .map((tag) => {
    const count = entries.filter((post) =>
      post.data.tags.includes(tag)
    ).length;
    return { name: tag, count };
  })
  .sort((a, b) => {
    if (b.count !== a.count) return b.count - a.count;
    return a.name.localeCompare(b.name);
  }); // Sort by frequency (highest first), then by name alphabetically
---

<BaseLayout title={title} description={description}>
  <div class="width-constrained-container column-container">
    <h1>{header}</h1>
    <hr />
    <div class="tag-cloud">
    {
      tagsWithCounts.map((tagData) => {
        return (
          <div class="tag-row surface-background-hover">
            <TagPill tag={tagData.name} parent={`/${collection}`} />
            <span class="text-meta">({tagData.count})</span>
          </div>
        );
      })
    }
    </div>
</BaseLayout>

<style>
  .column-container {
    padding: 0 var(--gap-lg);
    gap: var(--gap-lg);
  }
  .tag-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap-md);
  }
  .tag-row {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: var(--gap-md);
    padding: var(--gap-md);
    border-radius: var(--corner-md);
  }
</style>
