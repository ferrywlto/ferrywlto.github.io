---
import HeaderLink from "./HeaderLink.astro";
import CloseButton from "./CloseButton.astro";
import ThemeToggle from "./ThemeToggle.astro";
---

<div x-data
  x-show="$store.drawer"
  x-on:click="closeDrawer()"
  x-transition.duration.300ms
  x-transition.opacity
  x-cloak
  class="drawer-overlay"
>
</div>
<div x-data
  x-cloak
  x-show="$store.drawer"
  class="drawer"
>
  <div x-data
  class="drawer-header" x-on:close-button-clicked="closeDrawer()">
    <ThemeToggle />
    <h2 class="text-item-title">ferrywl.to</h2>
    <CloseButton />
  </div>
  <nav class="drawer-nav">
    <div class="nav-item"><HeaderLink href="/">🏠 Home</HeaderLink></div>
    <div class="nav-item"><HeaderLink href="/blogs">📝 Blog</HeaderLink></div>
    <div class="nav-item"><HeaderLink href="/diaries">📓 Diary</HeaderLink></div>
    <div class="nav-item"><HeaderLink href="/whispers">💬 Whispers</HeaderLink></div>
    <div class="nav-item"><HeaderLink href="/projects">🚀 Projects</HeaderLink></div>
    <div class="nav-item"><HeaderLink href="/about">👨🏻‍💻 About</HeaderLink></div>
  </nav>
</div>
<script>
import Alpine from "alpinejs";

  //@ts-ignore
  window.closeDrawer = function() {
    const drawer = document.querySelector('.drawer');
    if(drawer) {
      drawer.classList.add('drawer-close');
      setTimeout(() => {
        drawer.classList.remove('drawer-close');
        Alpine.store('drawer', false);
      }, 300);
    }
  }
</script>
<style>
  [x-cloak] { display: none !important; }

  @media screen and (max-width: 1024px) {
    .drawer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: color-mix(in srgb, var(--color-shadow) 10%, transparent);
      backdrop-filter: blur(8px) brightness(0.8);
      -webkit-backdrop-filter: blur(8px) brightness(0.8);
      z-index: 998;
      cursor: pointer;
    }

    .drawer {
      position: fixed;
      top: 0;
      left: 0;
      width: 50%;
      height: 100vh;
      background: var(--color-bg);
      z-index: 999;
      display: flex;
      flex-direction: column;
      /* animation: slideInFromLeft 0.3s ease-out; */
    }

    .drawer-open {
      animation: slideInFromLeft 0.3s ease-out;
    }

    .drawer-close {
      animation: slideOutToLeft 0.3s ease-in;
    }

    @keyframes slideOutToLeft {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(-100%);
      }
    }

    @keyframes slideInFromLeft {
      from {
        transform: translateX(-100%);
      }
      to {
        transform: translateX(0);
      }
    }

    .close-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2rem;
      height: 2rem;
      cursor: pointer;
      border-radius: var(--corner-sm);
      background: transparent;
      color: var(--color-text);
      font-size: 1.2rem;
      transition: background-color 0.2s ease;
    }

    .close-button:hover {
      background: var(--color-hover);
    }

    .drawer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--color-surface);
      padding: var(--gap-lg);
      box-shadow: var(--shadow-drawer);
      box-sizing: border-box;
      height: 3.8rem;

      border-bottom: 1px solid var(--color-shadow);
    }

    .drawer-nav {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      /* gap: var(--gap-xl); */

      box-sizing: border-box;
      background-color: var(--color-bg);
    }

    .nav-item {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      width: 100%;
      padding: var(--gap-lg);
      box-sizing: border-box;
      border-bottom: 1px solid var(--color-shadow);
    }
  }
</style>
