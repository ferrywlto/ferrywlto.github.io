---
import { getCollection } from 'astro:content';
import ContentPost from '../../layouts/ContentPost.astro';
import { render } from 'astro:content';
import type { ContentPath, TaggableCollection } from '../../types';

export async function getStaticPaths() {
  const collections: TaggableCollection[] = ['blogs', 'diaries', 'projects'] as const;
  // Improve performance by fetching collections in parallel
  const paths = await Promise.all(
    collections.map(async (collection) => {
      const posts = await getCollection(collection);
      return posts
      .filter((post) => post.data.draft !== true)
      .map<ContentPath>((post) => ({
        params: {
          collection,
          slug: post.id,
        },
        props: { post },
      }));
    })
  );

  return paths.flat();
}

const { collection } = Astro.params;
const { post } = Astro.props;
const { Content } = await render(post);
---

<ContentPost {...post.data} parent={collection}>
	<Content />
</ContentPost>
